import { describe, expect, it } from "vitest";
import { validateNormalizedCves } from "../domain/validation";
import { createSyntheticCve } from "./fixtures/synthetic-cves";

describe("domain/validation", () => {
  it("drops malformed entries and keeps valid ones", () => {
    const warnings: string[] = [];

    const valid = createSyntheticCve({ cveId: "CVE-2024-1001" });
    const invalid = {
      ...createSyntheticCve({ cveId: "CVE-2024-1002" }),
      cveId: "not-valid",
    } as unknown as typeof valid;

    const result = validateNormalizedCves([valid, invalid], warnings);

    expect(result).toHaveLength(1);
    expect(result[0].cveId).toBe("CVE-2024-1001");
    expect(warnings.some((item) => item.includes("dropped malformed"))).toBe(true);
  });
});
