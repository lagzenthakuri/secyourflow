import type { CveSearchConfig } from "../domain/types";

export function createTestConfig(overrides?: Partial<CveSearchConfig>): CveSearchConfig {
  const base: CveSearchConfig = {
    nvdApiBaseUrl: "https://nvd.test/rest/json/cves/2.0",
    mitreApiBaseUrl: "https://mitre.test/api/cve",
    cisaKevUrl: "https://kev.test/catalog.json",
    epssApiBaseUrl: "https://epss.test/data",
    timeouts: {
      perSourceMs: 80,
      overallRequestMs: 1_500,
    },
    retries: {
      maxRetries: 1,
      baseBackoffMs: 1,
    },
    circuitBreaker: {
      failureThreshold: 2,
      openMs: 30,
    },
    cacheTtlMs: {
      searchResults: 1_000,
      cveById: 1_000,
      kevCatalog: 5_000,
      epssScores: 5_000,
    },
  };

  return {
    ...base,
    ...overrides,
    timeouts: {
      ...base.timeouts,
      ...(overrides?.timeouts ?? {}),
    },
    retries: {
      ...base.retries,
      ...(overrides?.retries ?? {}),
    },
    circuitBreaker: {
      ...base.circuitBreaker,
      ...(overrides?.circuitBreaker ?? {}),
    },
    cacheTtlMs: {
      ...base.cacheTtlMs,
      ...(overrides?.cacheTtlMs ?? {}),
    },
  };
}
