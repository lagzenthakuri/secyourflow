export type LogLevel = "info" | "warn" | "error";

function safeStringify(value: Record<string, unknown>): string {
  try {
    return JSON.stringify(value);
  } catch {
    return JSON.stringify({ message: "failed to serialize log payload" });
  }
}

export function logEvent(level: LogLevel, event: string, data: Record<string, unknown> = {}): void {
  const payload = {
    module: "cve-search",
    level,
    event,
    timestamp: new Date().toISOString(),
    ...data,
  };

  const line = safeStringify(payload);
  if (level === "error") {
    console.error(line);
    return;
  }

  if (level === "warn") {
    console.warn(line);
    return;
  }

  console.log(line);
}
