import { normalizedCveSchema } from "./schemas";
import { normalizeCveTitle } from "./normalize";
import type { NormalizedCve } from "./types";

export function validateNormalizedCves(
  cves: NormalizedCve[],
  warnings: string[],
): NormalizedCve[] {
  const valid: NormalizedCve[] = [];

  for (const cve of cves) {
    const normalized = {
      ...cve,
      title: normalizeCveTitle(cve.title, cve.description, cve.cveId),
    };

    const result = normalizedCveSchema.safeParse(normalized);
    if (!result.success) {
      warnings.push(`validation: dropped malformed CVE ${cve.cveId}`);
      continue;
    }
    valid.push(result.data);
  }

  return valid;
}
