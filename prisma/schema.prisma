generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String         @id @default(cuid())
  email                 String         @unique
  emailVerified         DateTime?
  name                  String?
  password              String?
  image                 String?
  role                  Role           @default(ANALYST)
  avatar                String?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  lastLogin             DateTime?
  activeSessionId       String?
  activeSessionIp       String?
  organizationId        String?
  totpEnabled           Boolean        @default(false)
  totpSecretEnc         String?
  totpVerifiedAt        DateTime?
  totpRecoveryCodesHash Json?
  totpLastUsedStep      Int?
  accounts              Account[]
  auditLogs             AuditLog[]
  assetChangeLogs       AssetChangeLog[]               @relation("AssetChangeActor")
  assetLifecycleEvents  AssetLifecycleEvent[]          @relation("AssetLifecycleActor")
  assignedVulnerabilities Vulnerability[]              @relation("VulnerabilityAssignee")
  comments              Comment[]
  notifications         Notification[]
  notificationRules     NotificationRule[]
  dashboardViewSharesReceived DashboardViewShare[]     @relation("DashboardViewSharedWith")
  dashboardViews        DashboardView[]
  createdAssetGroups    AssetGroup[]                   @relation("AssetGroupCreatedBy")
  externalTickets       ExternalTicket[]
  remediationNotesAuthored RemediationNote[]           @relation("RemediationNoteAuthor")
  remediationEvidenceUploaded RemediationEvidence[]    @relation("RemediationEvidenceUploadedBy")
  remediationPlansOwned RemediationPlan[]              @relation("RemediationPlanOwner")
  reports               Report[]
  reportSchedules       ReportSchedule[]
  sessions              Session[]
  vulnerabilityTransitionsChanged VulnerabilityWorkflowTransition[] @relation("WorkflowChangedBy")
  complianceEvidenceUploaded         ComplianceEvidence[]        @relation("EvidenceUploadedBy")
  complianceEvidenceVersionsUploaded ComplianceEvidenceVersion[] @relation("EvidenceVersionUploadedBy")
  organization          Organization?  @relation(fields: [organizationId], references: [id])

  @@index([email])
  @@index([organizationId])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Organization {
  id                   String                @id @default(cuid())
  name                 String
  domain               String?
  logo                 String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  assets               Asset[]
  audits               Audit[]
  complianceFrameworks ComplianceFramework[]
  complianceEvidence   ComplianceEvidence[]
  complianceTrendSnapshots ComplianceTrendSnapshot[]
  dashboardViewShares  DashboardViewShare[]
  dashboardViews       DashboardView[]
  discoveryRuns        AssetDiscoveryRun[]
  externalTickets      ExternalTicket[]
  notificationRules    NotificationRule[]
  threatFeeds          ThreatFeed[]
  threatIndicators     ThreatIndicator[]
  threatFeedRuns       ThreatFeedRun[]
  threatIndicatorMatch ThreatIndicatorMatch[]
  policies             Policy[]
  reportArtifacts      ReportArtifact[]
  reportRuns           ReportRun[]
  reportSchedules      ReportSchedule[]
  reports              Report[]
  remediationEvidence  RemediationEvidence[]
  remediationNotes     RemediationNote[]
  remediationPlans     RemediationPlan[]
  riskEntries          RiskRegister[]
  settings             Setting?
  vulnerabilityTransitions VulnerabilityWorkflowTransition[]
  users                User[]
  vulnerabilities      Vulnerability[]
  assetRelationships   AssetRelationship[]
  assetGroups          AssetGroup[]
  assetLifecycleEvents AssetLifecycleEvent[]
  assetChangeLogs      AssetChangeLog[]
  wazuhAlerts          WazuhAlert[]

  @@index([name])
}

model Asset {
  id                 String                   @id @default(cuid())
  name               String
  type               AssetType
  hostname           String?
  ipAddress          String?
  macAddress         String?
  operatingSystem    String?
  version            String?
  environment        Environment              @default(PRODUCTION)
  criticality        Criticality              @default(MEDIUM)
  status             AssetStatus              @default(ACTIVE)
  owner              String?
  department         String?
  location           String?
  cloudProvider      CloudProvider?
  cloudRegion        String?
  cloudAccountId     String?
  tags               String[]
  metadata           Json?
  lastSeen           DateTime?
  createdAt          DateTime                 @default(now())
  updatedAt          DateTime                 @updatedAt
  organizationId     String
  organization       Organization             @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  childRelationships AssetRelationship[]      @relation("AssetParent")
  parentRelationships AssetRelationship[]     @relation("AssetChild")
  changeLogs         AssetChangeLog[]
  complianceControls AssetComplianceControl[]
  complianceEvidence ComplianceEvidence[]
  discoveryLinks     AssetDiscoveryRunAsset[]
  groupMembers       AssetGroupMember[]
  lifecycleEvents    AssetLifecycleEvent[]
  vulnerabilities    AssetVulnerability[]
  indicatorMatches   ThreatIndicatorMatch[]
  riskEntries        RiskRegister[]

  @@index([name])
  @@index([type])
  @@index([ipAddress])
  @@index([organizationId])
  @@index([criticality])
  @@index([organizationId, criticality])
  @@index([organizationId, environment])
  @@index([organizationId, status])
  @@index([organizationId, type])
  @@index([location])
  @@index([hostname])
}

model Vulnerability {
  id                 String                           @id @default(cuid())
  cveId              String?
  title              String
  description        String?
  severity           Severity
  cvssScore          Float?
  cvssVector         String?
  epssScore          Float?
  epssPercentile     Float?
  cweId              String?
  cweDescription     String?
  isExploited        Boolean                          @default(false)
  exploitMaturity    ExploitMaturity?
  cisaKev            Boolean                          @default(false)
  source             VulnSource
  scannerId          String?
  scannerName        String?
  firstDetected      DateTime                         @default(now())
  lastSeen           DateTime                         @default(now())
  status             VulnStatus                       @default(OPEN)
  workflowState      WorkflowState                    @default(NEW)
  assignedUserId     String?
  assignedTeam       String?
  slaDueAt           DateTime?
  triagedAt          DateTime?
  resolvedAt         DateTime?
  closedAt           DateTime?
  solution           String?
  references         String[]
  patchAvailable     Boolean                          @default(false)
  dueDate            DateTime?
  fixedAt            DateTime?
  riskScore          Float?
  businessImpact     String?
  metadata           Json?
  createdAt          DateTime                         @default(now())
  updatedAt          DateTime                         @updatedAt
  organizationId     String
  assignedUser       User?                            @relation("VulnerabilityAssignee", fields: [assignedUserId], references: [id], onDelete: SetNull)
  assets             AssetVulnerability[]
  comments           Comment[]
  externalTickets    ExternalTicket[]
  remediationEvidence RemediationEvidence[]
  remediationNotes   RemediationNote[]
  remediationPlans   RemediationPlanVulnerability[]
  riskEntries        RiskRegister[]
  organization       Organization                     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  complianceControls VulnerabilityComplianceControl[]
  attackTechniques   VulnerabilityAttackTechnique[]
  threatActors       VulnerabilityThreatActor[]
  workflowTransitions VulnerabilityWorkflowTransition[]

  @@index([cveId])
  @@index([severity])
  @@index([status])
  @@index([organizationId])
  @@index([isExploited])
  @@index([riskScore])
  @@index([organizationId, severity])
  @@index([organizationId, status])
  @@index([organizationId, isExploited])
  @@index([organizationId, cisaKev])
  @@index([workflowState])
  @@index([slaDueAt])
  @@index([assignedUserId])
  @@index([organizationId, workflowState])
  @@index([organizationId, slaDueAt])
  @@index([createdAt(sort: Desc)])
  @@index([severity, status])
  @@index([epssScore(sort: Desc)])
}

model AssetVulnerability {
  id              String        @id @default(cuid())
  assetId         String
  vulnerabilityId String
  port            Int?
  protocol        String?
  service         String?
  path            String?
  evidence        String?
  status          VulnStatus    @default(OPEN)
  firstDetected   DateTime      @default(now())
  lastSeen        DateTime      @default(now())
  asset           Asset         @relation(fields: [assetId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@unique([assetId, vulnerabilityId])
  @@index([assetId])
  @@index([vulnerabilityId])
  @@index([status])
}

model ComplianceFramework {
  id             String              @id @default(cuid())
  name           String
  version        String?
  description    String?
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organizationId String
  controls       ComplianceControl[]
  trendSnapshots ComplianceTrendSnapshot[]
  organization   Organization        @relation(fields: [organizationId], references: [id])

  @@index([name])
  @@index([organizationId])
}

model ComplianceControl {
  id                   String                           @id @default(cuid())
  controlId            String
  title                String
  description          String?
  category             String?
  objective            String?
  status               ComplianceStatus                 @default(NOT_ASSESSED)
  implementationStatus ImplementationStatus             @default(NOT_IMPLEMENTED)
  evidence             String?
  notes                String?
  lastAssessed         DateTime?
  nextAssessment       DateTime?
  createdAt            DateTime                         @default(now())
  updatedAt            DateTime                         @updatedAt
  frameworkId          String
  controlType          ControlType                      @default(PREVENTIVE)
  evidenceRequired     String[]
  frequency            ControlFrequency                 @default(ANNUAL)
  mappedControls       Json?
  maturityLevel        Int                              @default(0)
  nistCsfFunction      NistCsfFunction?
  ownerRole            String?
  riskCategory         String?
  assets               AssetComplianceControl[]
  evidenceFiles        ComplianceEvidence[]
  framework            ComplianceFramework              @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  vulnerabilities      VulnerabilityComplianceControl[]

  @@unique([frameworkId, controlId])
  @@index([frameworkId])
  @@index([status])
  @@index([controlId])
  @@index([maturityLevel])
  @@index([nistCsfFunction])
  @@index([frameworkId, status])
}

model AssetComplianceControl {
  id         String            @id @default(cuid())
  assetId    String
  controlId  String
  status     ComplianceStatus  @default(NOT_ASSESSED)
  evidence   String?
  assessedAt DateTime?
  asset      Asset             @relation(fields: [assetId], references: [id], onDelete: Cascade)
  control    ComplianceControl @relation(fields: [controlId], references: [id], onDelete: Cascade)

  @@unique([assetId, controlId])
  @@index([assetId])
  @@index([controlId])
}

model ComplianceEvidence {
  id             String                      @id @default(cuid())
  title          String
  description    String?
  controlId      String
  assetId        String?
  organizationId String
  uploadedById   String?
  currentVersion Int                         @default(1)
  createdAt      DateTime                    @default(now())
  updatedAt      DateTime                    @updatedAt
  asset          Asset?                      @relation(fields: [assetId], references: [id], onDelete: SetNull)
  control        ComplianceControl           @relation(fields: [controlId], references: [id], onDelete: Cascade)
  organization   Organization                @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  uploadedBy     User?                       @relation("EvidenceUploadedBy", fields: [uploadedById], references: [id], onDelete: SetNull)
  versions       ComplianceEvidenceVersion[]

  @@index([controlId])
  @@index([assetId])
  @@index([organizationId])
  @@index([createdAt(sort: Desc)])
}

model ComplianceEvidenceVersion {
  id           String              @id @default(cuid())
  evidenceId   String
  version      Int
  fileName     String
  mimeType     String
  sizeBytes    Int
  storagePath  String
  checksum     String?
  notes        String?
  uploadedById String?
  createdAt    DateTime            @default(now())
  evidence     ComplianceEvidence  @relation(fields: [evidenceId], references: [id], onDelete: Cascade)
  uploadedBy   User?               @relation("EvidenceVersionUploadedBy", fields: [uploadedById], references: [id], onDelete: SetNull)

  @@unique([evidenceId, version])
  @@index([evidenceId])
  @@index([createdAt(sort: Desc)])
}

model ComplianceTrendSnapshot {
  id                   String              @id @default(cuid())
  frameworkId          String
  organizationId       String
  snapshotDate         DateTime            @default(now())
  totalControls        Int
  compliant            Int
  nonCompliant         Int
  partiallyCompliant   Int
  notAssessed          Int
  compliancePercentage Float
  framework            ComplianceFramework @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  organization         Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([frameworkId, snapshotDate(sort: Desc)])
  @@index([organizationId, snapshotDate(sort: Desc)])
}

model VulnerabilityComplianceControl {
  id              String            @id @default(cuid())
  vulnerabilityId String
  controlId       String
  impact          String?
  control         ComplianceControl @relation(fields: [controlId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability     @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@unique([vulnerabilityId, controlId])
  @@index([vulnerabilityId])
  @@index([controlId])
}

model ThreatFeed {
  id             String            @id @default(cuid())
  name           String
  source         String
  type           ThreatFeedType
  format         ThreatFeedFormat  @default(JSON)
  url            String?
  apiKey         String?
  checkpoint     String?
  metadata       Json?
  isActive       Boolean           @default(true)
  lastSync       DateTime?
  syncInterval   Int               @default(3600)
  organizationId String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  indicators     ThreatIndicator[]
  runs           ThreatFeedRun[]
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([name])
  @@index([isActive])
  @@index([organizationId])
  @@unique([organizationId, name])
}

model ThreatIndicator {
  id              String                 @id @default(cuid())
  type            IndicatorType
  value           String
  normalizedValue String
  confidence      Int?
  severity        Severity?
  firstSeen       DateTime               @default(now())
  lastSeen        DateTime               @default(now())
  expiresAt       DateTime?
  source          String?
  description     String?
  tags            String[]
  metadata        Json?
  tacticId        String?
  techniqueId     String?
  feedId          String
  organizationId  String
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  feed            ThreatFeed             @relation(fields: [feedId], references: [id], onDelete: Cascade)
  organization    Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  matches         ThreatIndicatorMatch[]

  @@index([type])
  @@index([value])
  @@index([normalizedValue])
  @@index([feedId])
  @@index([organizationId])
  @@index([expiresAt])
  @@unique([organizationId, type, normalizedValue, feedId])
}

model ThreatFeedRun {
  id             String       @id @default(cuid())
  feedId         String
  organizationId String
  startedAt      DateTime     @default(now())
  finishedAt     DateTime?
  status         String       @default("RUNNING")
  recordsFetched Int          @default(0)
  recordsCreated Int          @default(0)
  recordsUpdated Int          @default(0)
  recordsSkipped Int          @default(0)
  checkpoint     String?
  errors         Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  feed           ThreatFeed   @relation(fields: [feedId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([feedId, startedAt(sort: Desc)])
  @@index([organizationId, startedAt(sort: Desc)])
}

model AttackTactic {
  id           String                  @id @default(cuid())
  externalId   String                  @unique
  name         String
  shortName    String?
  description  String?
  platforms    String[]
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  techniques   AttackTechniqueTactic[]

  @@index([name])
}

model AttackTechnique {
  id                 String                          @id @default(cuid())
  externalId         String                          @unique
  name               String
  description        String?
  isSubTechnique     Boolean                         @default(false)
  revoked            Boolean                         @default(false)
  platforms          String[]
  createdAt          DateTime                        @default(now())
  updatedAt          DateTime                        @updatedAt
  tactics            AttackTechniqueTactic[]
  vulnerabilityLinks VulnerabilityAttackTechnique[]
  actorLinks         ThreatActorTechnique[]
  campaignLinks      ThreatCampaignTechnique[]

  @@index([name])
}

model AttackTechniqueTactic {
  id          String          @id @default(cuid())
  techniqueId String
  tacticId    String
  createdAt   DateTime        @default(now())
  technique   AttackTechnique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)
  tactic      AttackTactic    @relation(fields: [tacticId], references: [id], onDelete: Cascade)

  @@unique([techniqueId, tacticId])
  @@index([tacticId])
}

model VulnerabilityAttackTechnique {
  id              String              @id @default(cuid())
  vulnerabilityId String
  techniqueId     String
  mappingSource   AttackMappingSource
  confidence      Int?
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  vulnerability   Vulnerability       @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)
  technique       AttackTechnique     @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([vulnerabilityId, techniqueId, mappingSource])
  @@index([techniqueId])
}

model ThreatIndicatorMatch {
  id             String          @id @default(cuid())
  indicatorId    String
  assetId        String
  organizationId String
  matchField     String
  matchValue     String
  status         ThreatMatchStatus @default(ACTIVE)
  confidence     Int?
  firstMatchedAt DateTime        @default(now())
  lastMatchedAt  DateTime        @default(now())
  resolvedAt     DateTime?
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  indicator      ThreatIndicator @relation(fields: [indicatorId], references: [id], onDelete: Cascade)
  asset          Asset           @relation(fields: [assetId], references: [id], onDelete: Cascade)
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([indicatorId, assetId, matchField])
  @@index([organizationId, status])
  @@index([assetId, status])
}

model ThreatActor {
  id                  String                  @id @default(cuid())
  externalId          String?                 @unique
  name                String
  description         String?
  aliases             String[]
  source              String?
  lastSeen            DateTime?
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  techniques          ThreatActorTechnique[]
  campaigns           ThreatCampaign[]
  vulnerabilityLinks  VulnerabilityThreatActor[]

  @@index([name])
}

model ThreatCampaign {
  id          String                  @id @default(cuid())
  externalId  String?                 @unique
  name        String
  description String?
  firstSeen   DateTime?
  lastSeen    DateTime?
  actorId     String?
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  actor       ThreatActor?            @relation(fields: [actorId], references: [id], onDelete: SetNull)
  techniques  ThreatCampaignTechnique[]

  @@index([name])
  @@index([actorId])
}

model ThreatActorTechnique {
  id          String          @id @default(cuid())
  actorId     String
  techniqueId String
  createdAt   DateTime        @default(now())
  actor       ThreatActor     @relation(fields: [actorId], references: [id], onDelete: Cascade)
  technique   AttackTechnique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([actorId, techniqueId])
  @@index([techniqueId])
}

model ThreatCampaignTechnique {
  id          String          @id @default(cuid())
  campaignId  String
  techniqueId String
  createdAt   DateTime        @default(now())
  campaign    ThreatCampaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  technique   AttackTechnique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([campaignId, techniqueId])
  @@index([techniqueId])
}

model VulnerabilityThreatActor {
  id              String              @id @default(cuid())
  vulnerabilityId String
  actorId         String
  source          AttackMappingSource
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  vulnerability   Vulnerability       @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)
  actor           ThreatActor         @relation(fields: [actorId], references: [id], onDelete: Cascade)

  @@unique([vulnerabilityId, actorId, source])
  @@index([actorId])
}

model AuditLog {
  id         String   @id @default(cuid())
  action     String
  entityType String
  entityId   String
  oldValue   Json?
  newValue   Json?
  ipAddress  String?
  userAgent  String?
  userId     String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@index([entityType, createdAt(sort: Desc)])
  @@index([userId, createdAt(sort: Desc)])
  @@index([ipAddress])
}

model Comment {
  id              String         @id @default(cuid())
  content         String
  entityType      String
  entityId        String
  userId          String
  vulnerabilityId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability? @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([userId])
}

model ScannerConfig {
  id           String       @id @default(cuid())
  name         String
  type         VulnSource
  endpoint     String?
  apiKey       String?
  username     String?
  password     String?
  isActive     Boolean      @default(true)
  lastSync     DateTime?
  syncInterval Int          @default(86400)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  scanResults  ScanResult[]

  @@index([type])
  @@index([isActive])
}

model ScanResult {
  id         String        @id @default(cuid())
  scanId     String
  startTime  DateTime
  endTime    DateTime?
  status     ScanStatus    @default(RUNNING)
  totalHosts Int           @default(0)
  totalVulns Int           @default(0)
  rawData    Json?
  scannerId  String
  createdAt  DateTime      @default(now())
  scanner    ScannerConfig @relation(fields: [scannerId], references: [id], onDelete: Cascade)

  @@index([scanId])
  @@index([scannerId])
  @@index([status])
}

model RiskSnapshot {
  id               String   @id @default(cuid())
  date             DateTime @default(now())
  totalAssets      Int
  criticalAssets   Int
  totalVulns       Int
  criticalVulns    Int
  highVulns        Int
  mediumVulns      Int
  lowVulns         Int
  exploitedVulns   Int
  cisaKevVulns     Int
  overallRiskScore Float
  complianceScore  Float?
  metadata         Json?

  @@index([date])
}

model Setting {
  id                      String       @id @default(cuid())
  organizationId          String       @unique
  timezone                String       @default("UTC")
  dateFormat              String       @default("MMM DD, YYYY")
  notifyCritical          Boolean      @default(true)
  notifyExploited         Boolean      @default(true)
  notifyCompliance        Boolean      @default(true)
  notifyScan              Boolean      @default(false)
  notifyWeekly            Boolean      @default(true)
  require2FA              Boolean      @default(true)
  sessionTimeout          Int          @default(30)
  passwordPolicy          String       @default("STRONG")
  updatedAt               DateTime     @updatedAt
  aiRiskAssessmentEnabled Boolean      @default(true)
  organization            Organization @relation(fields: [organizationId], references: [id])
}

model Report {
  id             String       @id @default(cuid())
  name           String
  type           String
  templateKey    ReportTemplateKey?
  description    String?
  format         String       @default("PDF")
  outputFormat   ReportOutputFormat?
  frequency      String?
  status         String       @default("PENDING")
  url            String?
  size           String?
  scheduleId     String?
  organizationId String
  userId         String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  schedule       ReportSchedule? @relation(fields: [scheduleId], references: [id], onDelete: SetNull)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  runs           ReportRun[]

  @@index([organizationId])
  @@index([userId])
  @@index([scheduleId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO")
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([userId, createdAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
}

model RiskRegister {
  id               String        @id @default(cuid())
  assetId          String
  vulnerabilityId  String
  organizationId   String
  riskScore        Float
  impactScore      Float
  likelihoodScore  Float
  status           String        @default("ACTIVE")
  aiAnalysis       Json
  treatmentOption  String?
  responsibleParty String?
  confidence       Float?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  actionPlan       String?
  currentControls  String?
  isResolved       Boolean       @default(false)
  remarks          String?
  riskCategory2    String?
  selectedControls String?
  asset            Asset         @relation(fields: [assetId], references: [id], onDelete: Cascade)
  organization     Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  vulnerability    Vulnerability @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([vulnerabilityId])
  @@index([organizationId])
  @@index([organizationId, status])
  @@index([riskScore(sort: Desc)])
  @@index([organizationId, riskScore(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@index([assetId, vulnerabilityId])
}

model VulnerabilityWorkflowTransition {
  id              String        @id @default(cuid())
  vulnerabilityId String
  organizationId  String
  fromState       WorkflowState?
  toState         WorkflowState
  changedById     String?
  note            String?
  changedAt       DateTime      @default(now())
  createdAt       DateTime      @default(now())
  changedBy       User?         @relation("WorkflowChangedBy", fields: [changedById], references: [id], onDelete: SetNull)
  organization    Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@index([vulnerabilityId, changedAt(sort: Desc)])
  @@index([organizationId, changedAt(sort: Desc)])
  @@index([changedById])
}

model RemediationPlan {
  id             String                 @id @default(cuid())
  organizationId String
  ownerId        String?
  name           String
  description    String?
  status         RemediationPlanStatus  @default(DRAFT)
  dueDate        DateTime?
  completedAt    DateTime?
  metadata       Json?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  organization   Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  owner          User?                  @relation("RemediationPlanOwner", fields: [ownerId], references: [id], onDelete: SetNull)
  vulnerabilities RemediationPlanVulnerability[]
  notes          RemediationNote[]
  evidence       RemediationEvidence[]
  tickets        ExternalTicket[]

  @@index([organizationId, status])
  @@index([organizationId, dueDate])
  @@index([ownerId])
}

model RemediationPlanVulnerability {
  id              String        @id @default(cuid())
  planId          String
  vulnerabilityId String
  progress        Int           @default(0)
  createdAt       DateTime      @default(now())
  plan            RemediationPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@unique([planId, vulnerabilityId])
  @@index([vulnerabilityId])
}

model RemediationNote {
  id              String          @id @default(cuid())
  organizationId  String
  planId          String?
  vulnerabilityId String?
  authorId        String?
  content         String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  author          User?           @relation("RemediationNoteAuthor", fields: [authorId], references: [id], onDelete: SetNull)
  organization    Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  plan            RemediationPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  vulnerability   Vulnerability?  @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@index([organizationId, createdAt(sort: Desc)])
  @@index([planId])
  @@index([vulnerabilityId])
  @@index([authorId])
}

model RemediationEvidence {
  id              String          @id @default(cuid())
  organizationId  String
  planId          String?
  vulnerabilityId String?
  uploadedById    String?
  title           String
  fileName        String
  mimeType        String
  sizeBytes       Int
  storagePath     String
  checksum        String?
  notes           String?
  createdAt       DateTime        @default(now())
  organization    Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  plan            RemediationPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  uploadedBy      User?           @relation("RemediationEvidenceUploadedBy", fields: [uploadedById], references: [id], onDelete: SetNull)
  vulnerability   Vulnerability?  @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@index([organizationId, createdAt(sort: Desc)])
  @@index([planId])
  @@index([vulnerabilityId])
  @@index([uploadedById])
}

model ExternalTicket {
  id              String         @id @default(cuid())
  organizationId  String
  provider        TicketProvider
  syncStatus      TicketSyncStatus @default(LINKED)
  externalId      String
  externalKey     String?
  externalUrl     String?
  externalStatus  String?
  title           String?
  payload         Json?
  vulnerabilityId String?
  planId          String?
  userId          String?
  lastSyncedAt    DateTime?
  lastSyncError   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  organization    Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  plan            RemediationPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  user            User?          @relation(fields: [userId], references: [id], onDelete: SetNull)
  vulnerability   Vulnerability? @relation(fields: [vulnerabilityId], references: [id], onDelete: Cascade)

  @@unique([provider, externalId])
  @@index([organizationId, provider])
  @@index([syncStatus, lastSyncedAt])
  @@index([vulnerabilityId])
  @@index([planId])
}

model ReportSchedule {
  id             String            @id @default(cuid())
  organizationId String
  userId         String
  name           String
  templateKey    ReportTemplateKey
  frequency      ReportFrequency
  outputFormat   ReportOutputFormat @default(PDF)
  recipients     String[]          @default([])
  filters        Json?
  isActive       Boolean           @default(true)
  nextRunAt      DateTime
  lastRunAt      DateTime?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  reports        Report[]
  runs           ReportRun[]
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([organizationId, isActive])
  @@index([nextRunAt, isActive])
  @@index([userId])
}

model ReportRun {
  id             String       @id @default(cuid())
  organizationId String
  scheduleId     String?
  reportId       String?
  status         String       @default("PENDING")
  startedAt      DateTime     @default(now())
  completedAt    DateTime?
  errorMessage   String?
  metadata       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  artifacts      ReportArtifact[]
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  report         Report?      @relation(fields: [reportId], references: [id], onDelete: SetNull)
  schedule       ReportSchedule? @relation(fields: [scheduleId], references: [id], onDelete: SetNull)

  @@index([organizationId, createdAt(sort: Desc)])
  @@index([scheduleId, createdAt(sort: Desc)])
  @@index([status])
}

model ReportArtifact {
  id             String             @id @default(cuid())
  organizationId String
  reportRunId    String
  format         ReportOutputFormat
  fileName       String
  mimeType       String
  sizeBytes      Int
  data           Bytes
  checksum       String?
  createdAt      DateTime           @default(now())
  organization   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  reportRun      ReportRun          @relation(fields: [reportRunId], references: [id], onDelete: Cascade)

  @@index([reportRunId])
  @@index([organizationId, createdAt(sort: Desc)])
}

model DashboardView {
  id             String               @id @default(cuid())
  organizationId String
  userId         String
  name           String
  layout         Json
  isDefault      Boolean              @default(false)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  organization   Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  shares         DashboardViewShare[]
  user           User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([organizationId, userId])
  @@index([organizationId, isDefault])
}

model DashboardViewShare {
  id               String        @id @default(cuid())
  dashboardViewId  String
  organizationId   String
  sharedWithUserId String?
  sharedWithRole   Role?
  canEdit          Boolean       @default(false)
  createdAt        DateTime      @default(now())
  dashboardView    DashboardView @relation(fields: [dashboardViewId], references: [id], onDelete: Cascade)
  organization     Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  sharedWithUser   User?         @relation("DashboardViewSharedWith", fields: [sharedWithUserId], references: [id], onDelete: Cascade)

  @@index([organizationId, sharedWithRole])
  @@index([sharedWithUserId])
  @@unique([dashboardViewId, sharedWithUserId, sharedWithRole])
}

model AssetRelationship {
  id               String                @id @default(cuid())
  organizationId   String
  parentAssetId    String
  childAssetId     String
  relationshipType AssetRelationshipType
  notes            String?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  childAsset       Asset                 @relation("AssetChild", fields: [childAssetId], references: [id], onDelete: Cascade)
  organization     Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parentAsset      Asset                 @relation("AssetParent", fields: [parentAssetId], references: [id], onDelete: Cascade)

  @@unique([parentAssetId, childAssetId, relationshipType])
  @@index([organizationId, parentAssetId])
  @@index([organizationId, childAssetId])
}

model AssetGroup {
  id             String            @id @default(cuid())
  organizationId String
  createdById    String?
  name           String
  description    String?
  color          String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  createdBy      User?             @relation("AssetGroupCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)
  members        AssetGroupMember[]
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, name])
  @@index([organizationId])
}

model AssetGroupMember {
  id      String     @id @default(cuid())
  groupId String
  assetId String
  addedAt DateTime   @default(now())
  asset   Asset      @relation(fields: [assetId], references: [id], onDelete: Cascade)
  group   AssetGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, assetId])
  @@index([assetId])
}

model AssetLifecycleEvent {
  id              String             @id @default(cuid())
  organizationId  String
  assetId         String
  actorId         String?
  eventType       LifecycleEventType
  fromEnvironment Environment?
  toEnvironment   Environment?
  fromOwner       String?
  toOwner         String?
  notes           String?
  occurredAt      DateTime           @default(now())
  createdAt       DateTime           @default(now())
  actor           User?              @relation("AssetLifecycleActor", fields: [actorId], references: [id], onDelete: SetNull)
  asset           Asset              @relation(fields: [assetId], references: [id], onDelete: Cascade)
  organization    Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([assetId, occurredAt(sort: Desc)])
  @@index([organizationId, occurredAt(sort: Desc)])
}

model AssetChangeLog {
  id             String       @id @default(cuid())
  organizationId String
  assetId        String
  changedById    String?
  field          String
  oldValue       Json?
  newValue       Json?
  changedAt      DateTime     @default(now())
  asset          Asset        @relation(fields: [assetId], references: [id], onDelete: Cascade)
  changedBy      User?        @relation("AssetChangeActor", fields: [changedById], references: [id], onDelete: SetNull)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([assetId, changedAt(sort: Desc)])
  @@index([organizationId, changedAt(sort: Desc)])
}

model AssetDiscoveryRun {
  id             String                 @id @default(cuid())
  organizationId String
  source         String
  status         String                 @default("PENDING")
  startedAt      DateTime               @default(now())
  finishedAt     DateTime?
  discoveredCount Int                   @default(0)
  createdCount   Int                    @default(0)
  updatedCount   Int                    @default(0)
  rawInput       Json?
  errorMessage   String?
  metadata       Json?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  assets         AssetDiscoveryRunAsset[]
  organization   Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId, startedAt(sort: Desc)])
  @@index([source, status])
}

model AssetDiscoveryRunAsset {
  id             String            @id @default(cuid())
  discoveryRunId String
  assetId        String
  action         String
  asset          Asset             @relation(fields: [assetId], references: [id], onDelete: Cascade)
  discoveryRun   AssetDiscoveryRun @relation(fields: [discoveryRunId], references: [id], onDelete: Cascade)

  @@unique([discoveryRunId, assetId])
  @@index([assetId])
}

model NotificationRule {
  id               String              @id @default(cuid())
  organizationId   String
  userId           String
  name             String
  isActive         Boolean             @default(true)
  channel          NotificationChannel @default(IN_APP)
  eventType        String
  minimumSeverity  Severity?
  includeExploited Boolean             @default(false)
  includeKev       Boolean             @default(false)
  recipients       String[]            @default([])
  webhookUrl       String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  organization     Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user             User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([organizationId, isActive])
  @@index([userId, isActive])
  @@index([eventType])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Cve {
  id             String                   @id
  cveId          String                   @unique
  description    String
  publishedAt    DateTime
  lastModifiedAt DateTime
  severity       Severity
  cweIds         String[]
  searchVector   Unsupported("tsvector")?
  status         CveStatus                @default(ACTIVE)
  isKev          Boolean                  @default(false)
  epssScore      Float?
  epssPercentile Float?
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime
  CveCpe         CveCpe[]
  CveCvss        CveCvss[]
  CveProvenance  CveProvenance[]
  CveReference   CveReference[]
  KevEntry       KevEntry?

  @@index([cveId])
  @@index([cveId], map: "Cve_cveId_pattern_idx")
  @@index([epssScore])
  @@index([isKev, severity])
  @@index([publishedAt(sort: Desc)])
  @@index([severity, publishedAt])
  @@index([status, lastModifiedAt])
  @@index([status, publishedAt])
  @@index([status, severity, publishedAt(sort: Desc)], map: "Cve_status_severity_published_idx")
  @@index([cveId(ops: raw("gin_trgm_ops"))], map: "Cve_cveId_trgm_idx", type: Gin)
  @@index([searchVector], type: Gin)
}

model CveCpe {
  id                    String  @id
  cveId                 String
  cpeUri                String
  vendor                String
  product               String
  version               String
  versionStartIncluding String?
  versionEndExcluding   String?
  vulnerable            Boolean
  Cve                   Cve     @relation(fields: [cveId], references: [cveId])

  @@index([cveId])
  @@index([vendor, product])
}

model CveCvss {
  id                  String @id
  cveId               String
  version             String
  vectorString        String
  baseScore           Float
  baseSeverity        String
  exploitabilityScore Float?
  impactScore         Float?
  Cve                 Cve    @relation(fields: [cveId], references: [cveId])

  @@index([cveId])
}

model CveProvenance {
  id          String   @id
  cveId       String
  source      String
  field       String
  lastUpdated DateTime
  checksum    String
  Cve         Cve      @relation(fields: [cveId], references: [cveId])

  @@index([cveId, source])
  @@index([source, lastUpdated(sort: Desc)])
}

model CveReference {
  id     String   @id
  cveId  String
  url    String
  source String
  tags   String[]
  Cve    Cve      @relation(fields: [cveId], references: [cveId])

  @@index([cveId])
}

model IngestionState {
  id               String    @id
  source           String    @unique
  lastSyncAt       DateTime
  lastSuccessAt    DateTime?
  status           String
  errorMessage     String?
  recordsProcessed Int       @default(0)

  @@index([source])
}

model KevEntry {
  id                String   @id
  cveId             String   @unique
  vulnerabilityName String
  dateAdded         DateTime
  dueDate           DateTime
  requiredAction    String
  notes             String?
  Cve               Cve      @relation(fields: [cveId], references: [cveId])

  @@index([cveId])
  @@index([dueDate])
}

model Policy {
  id             String       @id @default(cuid())
  title          String
  description    String?
  version        String       @default("1.0")
  status         PolicyStatus @default(DRAFT)
  type           String?
  url            String?
  owner          String?
  lastReview     DateTime?
  nextReview     DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([status])
}

model Audit {
  id              String       @id @default(cuid())
  title           String
  type            AuditType    @default(INTERNAL)
  status          AuditStatus  @default(PLANNED)
  scope           String?
  findings        String?
  recommendations String?
  startDate       DateTime?
  endDate         DateTime?
  periodStart     DateTime?
  periodEnd       DateTime?
  auditor         String?
  reportUrl       String?
  organizationId  String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([status])
  @@index([type])
}

enum Role {
  IT_OFFICER
  PENTESTER
  ANALYST
  MAIN_OFFICER
}

enum AssetType {
  SERVER
  WORKSTATION
  NETWORK_DEVICE
  CLOUD_INSTANCE
  CONTAINER
  DATABASE
  APPLICATION
  API
  DOMAIN
  CERTIFICATE
  IOT_DEVICE
  MOBILE_DEVICE
  OTHER
}

enum Environment {
  PRODUCTION
  STAGING
  DEVELOPMENT
  TESTING
  DR
}

enum Criticality {
  CRITICAL
  HIGH
  MEDIUM
  LOW
  INFORMATIONAL
}

enum AssetStatus {
  ACTIVE
  INACTIVE
  DECOMMISSIONED
  MAINTENANCE
}

enum CloudProvider {
  AWS
  AZURE
  GCP
  ORACLE
  IBM
  ALIBABA
  OTHER
}

enum Severity {
  CRITICAL
  HIGH
  MEDIUM
  LOW
  INFORMATIONAL
}

enum VulnStatus {
  OPEN
  IN_PROGRESS
  MITIGATED
  FIXED
  ACCEPTED
  FALSE_POSITIVE
}

enum VulnSource {
  NESSUS
  OPENVAS
  NMAP
  TRIVY
  QUALYS
  RAPID7
  CROWDSTRIKE
  MANUAL
  API
  OTHER
  TENABLE
}

enum ExploitMaturity {
  NOT_DEFINED
  UNPROVEN
  POC
  FUNCTIONAL
  HIGH
}

enum ComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  PARTIALLY_COMPLIANT
  NOT_ASSESSED
  NOT_APPLICABLE
}

enum ImplementationStatus {
  IMPLEMENTED
  PARTIALLY_IMPLEMENTED
  PLANNED
  NOT_IMPLEMENTED
  NOT_APPLICABLE
}

enum ThreatFeedType {
  CVE
  MALWARE
  IOC
  THREAT_ACTOR
  CAMPAIGN
}

enum ThreatFeedFormat {
  JSON
  CSV
  TAXII
}

enum AttackMappingSource {
  CVE_REFERENCE
  CWE_MAPPING
  MANUAL
  ACTOR_REFERENCE
  TECHNIQUE_INFERENCE
}

enum ThreatMatchStatus {
  ACTIVE
  EXPIRED
  RESOLVED
}

enum IndicatorType {
  IP_ADDRESS
  DOMAIN
  URL
  FILE_HASH_MD5
  FILE_HASH_SHA1
  FILE_HASH_SHA256
  EMAIL
  CVE
  REGISTRY_KEY
  USER_AGENT
}

enum ScanStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum CveStatus {
  ACTIVE
  REJECTED
  RESERVED
}

enum ControlType {
  PREVENTIVE
  DETECTIVE
  CORRECTIVE
}

enum ControlFrequency {
  CONTINUOUS
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  ANNUAL
}

enum NistCsfFunction {
  GOVERN
  IDENTIFY
  PROTECT
  DETECT
  RESPOND
  RECOVER
}

enum WorkflowState {
  NEW
  TRIAGED
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum RemediationPlanStatus {
  DRAFT
  ACTIVE
  BLOCKED
  COMPLETED
  ARCHIVED
}

enum TicketProvider {
  GITHUB
  JIRA
}

enum TicketSyncStatus {
  LINKED
  OUT_OF_SYNC
  ERROR
  DISCONNECTED
}

enum ReportTemplateKey {
  EXECUTIVE_POSTURE
  RISK_TREND
  TOP_RISKS
  COMPLIANCE_SUMMARY
  VULN_ASSESSMENT
  PENTEST_FINDINGS
  ASSET_INVENTORY
  REMEDIATION_TRACKING
}

enum ReportOutputFormat {
  PDF
  CSV
  XLSX
}

enum ReportFrequency {
  DAILY
  WEEKLY
  MONTHLY
}

enum AssetRelationshipType {
  HOSTS
  RUNS_ON
  DEPENDS_ON
  CONNECTS_TO
  CONTAINS
}

enum LifecycleEventType {
  CREATED
  TRANSFERRED
  OWNERSHIP_CHANGED
  DECOMMISSION_REQUESTED
  DECOMMISSIONED
  REACTIVATED
}

enum NotificationChannel {
  IN_APP
  EMAIL
  WEBHOOK
}

enum PolicyStatus {
  DRAFT
  ACTIVE
  ARCHIVED
  UNDER_REVIEW
}

enum AuditType {
  INTERNAL
  EXTERNAL
  REGULATORY
  THIRD_PARTY
}

enum AuditStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model WazuhAlert {
  id             String       @id
  level          Int
  ruleId         String
  agentId        String
  timestamp      DateTime
  raw            Json
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now())

  @@index([organizationId])
  @@index([level])
  @@index([ruleId])
  @@index([agentId])
  @@index([timestamp])
}
